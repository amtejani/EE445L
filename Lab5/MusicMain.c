// ******** MusicMain.c ************** 
// Ali Tejani and Caroline Yao
// amt3639 and chy253
// Creation Date: 2/26/2017
// Main file to test music/DAC funtionality
// Lab section: Tue/Thur 12:30 - 2 PM
// TA: Lavanya
// Last Revision: 2/28/2017

#include <stdint.h>
#include "PLL.h"
#include "Music.h"
#include "Switch.h"
#include "ST7735.h"

// Create Song
const uint32_t SongLength = 180;
uint32_t Track1[SongLength] = {1896,2008,1896,2008,1896,2530,2128,2388,2840,2840,0,4777,3792,2840,2530,2530,0,3792,3009,2530,2388,2388,0,3792,1896,2008,
			1896,2008,1896,2530,2128,2388,2840,2840,0,4777,3792,2840,2530,2530,0,3792,2388,2530,2840,2840,2840,2840,1896,2008,1896,2008,1896,2530,2128,2388,
			2840,2840,0,4777,3792,2840,2530,2530,0,3792,3009,2530,2388,2388,0,3792,1896,2008,1896,2008,1896,2530,2128,2388,2840,2840,0,4777,3792,2840,
			2530,2530,0,3792,2388,2530,2840,2840,0,2530,2388,2128,1896,1896,0,3188,1789,1896,2128,2128,0,3579,1896,2128,2388,2388,0,3792,2128,2388,
			2530,2530,0,3792,1896,0,0,3792,1896,2008,1896,2128,1896,2008,1896,2128,1896,2128,1896,2008,1896,2530,2128,2388,
			2840,2840,0,4777,3792,2840,2530,2530,0,3792,3009,2530,2388,2388,0,3792,1896,2008,
			1896,2008,1896,2530,2128,2388,2840,2840,0,4777,3792,2840,2530,2530,0,3792,2388,2530,2840,2840,2840,2840};
uint32_t Durations1[SongLength] = {1,1,1,1,1,1,1,1,2,2,0,1,1,1,2,2,0,1,1,1,2,2,0,1,1,1,
			1,1,1,1,1,1,2,2,0,1,1,1,2,2,0,1,1,1,4,4,4,4,1,1,1,1,1,1,1,1,
			2,2,0,1,1,1,2,2,0,1,1,1,2,2,0,1,1,1,1,1,1,1,1,1,2,2,0,1,1,1,
			2,2,0,1,1,1,2,2,0,1,1,1,2,2,0,1,1,1,2,2,0,1,1,1,2,2,0,1,1,1,
			2,2,0,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
			2,2,0,1,1,1,2,2,0,1,1,1,2,2,0,1,1,1,
			1,1,1,1,1,1,2,2,0,1,1,1,2,2,0,1,1,1,4,4,4,4};
uint32_t Track2[SongLength] = {0,0,0,0,0,0,0,0,11363,7584,5681,0,0,0,7584,6019,5061,0,0,0,11363,7584,5681,0,0,0,
			0,0,0,0,0,0,11363,7584,5681,0,0,0,7584,6019,5061,0,0,0,11363,7584,5681,0,0,0,0,0,0,0,0,0,
			11363,7584,5681,0,0,0,7584,6019,5061,0,0,0,11363,7584,5681,0,0,0,0,0,0,0,0,0,11363,7584,5681,0,0,0,
			7584,6019,5061,0,0,0,11363,7584,5681,0,0,0,9555,6377,4777,0,0,0,6377,5061,4256,0,0,0,11363,7584,5681,0,0,0,
			7584,5061,3792,0,0,7584,3792,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
			11363,7584,5681,0,0,0,7584,6019,5061,0,0,0,11363,7584,5681,0,0,0,
			0,0,0,0,0,0,11363,7584,5681,0,0,0,7584,6019,5061,0,0,0,5681,5681,5681,5681};
uint32_t Durations2[SongLength] = {0,0,0,0,0,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0,
			0,0,0,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,
			1,1,1,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,
			1,1,1,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0,
			1,1,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
			1,1,1,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0,
			0,0,0,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0,4,4,4,4};
song Song = {SongLength,Track1,Durations1,Track2,Durations2};



// Subroutine to wait 10 msec
void DelayWait10ms(uint32_t n){uint32_t volatile time;
  while(n){
    time = 727240*2/91;  // 10msec
    while(time){
	  	time--;
    }
    n--;
  }
}

int main(void) {
	PLL_Init(Bus80MHz);				// init modules
	Switch_Init(PlayPause,ChangeInstrument,Music_Rewind);
	Music_Init(&Song);
	ST7735_InitR(INITR_REDTAB);
	ST7735_OutString("Left Button:\r");
	ST7735_OutString(" Rewind\r");
	ST7735_OutString("Right Button:\r");
	ST7735_OutString(" Play/Pause\r");
	ST7735_OutString("External Button:\r");
	ST7735_OutString(" Change Instrument");
	while(1) {
		// do nothing
	}
}

	
